---
title: "Regresión con variables contiuas y categóricas"
author: "Los regresores"
date: "2/11/2019"
output:
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.align = "center", fig.width = 7, fig.height = 4)
```


```{r librerias, include=FALSE}
library(tidyverse)
library(ggpubr)
```

```{r lectura, include=FALSE}
datos <- read_table2("http://allman.rhon.itam.mx/~ebarrios/EstApl2-2019/controles/control3/bacterias.dat", col_types = cols(
  Acid = col_factor(levels = c("B", "A")), 
  Conc = col_factor(levels = c("L", "H")), 
  Temp = col_factor(levels = c("30", "60", "90"))
    )
  )
```
En un laboratorio clínico se llevó a cabo un experimento para valorar cómo el nivel de temperatura y la naturaleza ácida de cierto caldo de cultivo influía en el crecimiento de una población de bacterias.

Más específicamente, se consideraron dos factores: temperatura, a tres distintos niveles: 30°C, 60°C y 90°C; dos tipos de caldo de cultivo: básico (B) y ácido (A), cada uno de ellos a dos niveles de concentraciones: baja (L) y alta (H). Como respuesta se consideró como se modificaba una población inicial de 1000 bacterias después de 48 horas de en el ambiente controlado.


```{r echo=FALSE}
pl1 <- ggplot(data = datos, mapping = aes(x = Temp, y = Nbact)) + 
  geom_boxplot() + 
  geom_point(mapping = aes(color = Acid)) + 
  labs(x = "Temperatura", y = "Número de bacterias", color = "Naturaleza ácida", caption = "Figura 1.1 Bacterias por temperatura") + 
  theme_minimal() + 
  scale_color_discrete(labels = c("básico", "ácido")) +
  theme(plot.caption = element_text(hjust = 0.5)) 
pl2 <- ggplot(data = datos, aes(x = Acid, y = Nbact)) + 
  geom_boxplot() + 
  geom_point(mapping = aes(color = Temp)) + 
  labs(x = "Naturaleza ácida", y = "Número de bacterias", color = "Temperatura", caption = "Figura 1.2 Bacterias por acidez") + 
  theme_minimal() + 
  scale_color_discrete(labels = c("30°", "60°", "90°")) +
  theme(plot.caption = element_text(hjust = 0.5))
ggarrange(pl1, pl2) 
```



Con el objetivo de observar el comportamiento que tiene el número de bacterias dependiendo de la temperatura se analizó el diagrama de caja y brazos de la figura 1.1. 

De donde se observa que el mínimo crecimiento de bacterias entre las temperaturas se presentó a 90 grados Celsius.Por otra parte el mayor crecimiento entre las temperaturas se observó en los 60 grados. De lo que se concluye que la temperatura de 60 grados favorece al crecimiento de las bacterias y por el contrario a 90 grados no hay un creciento tan elevado.

Por otro lado de la figura 1.2 se observó que tanto el mínimo como el máximo de bacterias se observó en los cultivos básicos (B),el rango de este tipo de cultivo resultó mayor que el rango del cultivo ácido. Finalmente de este gráfico es importante notar que la media en los caldos de cultivo tipo ácido (A) fue mayor a la media en los cultivos tipo básico (B).



```{r echo=FALSE}
temp.labs <- c("30°C", "60°C", "90°C")
names(temp.labs) <- c("30", "60", "90")
acid.labs <- c("básico", "ácido")
names(acid.labs) <- c("B", "A")
ggplot(data = datos, aes(x = obs, y = Nbact)) + 
  geom_point(aes(color = Conc)) + 
  facet_grid(Acid ~ Temp, labeller = labeller(Acid = acid.labs, Temp = temp.labs)) + 
  theme_bw() +
  labs(x = "Observaciones", y = "Número de bacterias", caption = "Figura 2. Gráfica", color = "Concentración") + 
  theme(plot.caption = element_text(hjust = 0.5)) +
  scale_color_discrete(labels = c("baja", "alta")) 
```


Para una descripción más detallada de los datos es relevante analizar la gráfica de la figura 2. Donde es más clara el comportamiento de los tipos de caldo de cultivo. 

Es claro  que para el caldo de cultivo tipo básico (B) la temperatura a la que existe mayor crecimiento de bacterias es 60 grados. Mientras que para los 30 y 90 grados el crecimiento es similar aunque a 90 grados se registran los mínimos de crecimiento más bajos. 

Por su parte en el caldo de cultivo tipo ácido (A) no es tan evidente que la temperatura de 60 grados sea la que más fomente el crecimiento de bacterias ya que es muy similar el comportamiento a 30 grados,sin embargo sigue siendo la que predomina.Finalmetne lo que es fácil concluir es que la temperatura a la que se registra menor crecimiento es a los 90 grados.


Número de bacterias explicado por la temperatura:
```{r}
reg1 <- lm(Nbact ~ Temp, data = datos)

reg1 %>% 
  summary()

reg1 %>% 
  anova()
```

```{r echo=FALSE}
graf1_1 <- ggplot() + 
  geom_point(mapping = aes(x = reg1$fitted.values, y = reg1$residuals)) + 
  labs(x = "Respuesta Ajustada", y = "Residuales", caption = "Figura: Análisis de Residuales") + 
  theme(plot.caption = element_text(hjust = 0.5))

graf1_2 <- ggplot(mapping = aes(sample = reg1$residuals)) + 
  geom_qq() + 
  geom_qq_line() + 
  coord_flip() + 
  labs(x = "Residuales", y = "Escala Normal", caption = "Figura: Gráfica cuantil-cuantil") + 
  theme(plot.caption = element_text(hjust = 0.5))

ggarrange(graf1_1, graf1_2)
```


Número de bacterias explicado por la naturaleza ácida:
```{r}
reg2 <- lm(Nbact ~ Acid, data = datos)

reg2 %>% 
  summary()

reg2 %>% 
  anova()
```

```{r echo=FALSE}
graf2_1 <- ggplot() + 
  geom_point(mapping = aes(x = reg2$fitted.values, y = reg2$residuals)) +
  labs(x = "Respuesta Ajustada", y = "Residuales", caption = "Figura: Análisis de Residuales") + 
  theme(plot.caption = element_text(hjust = 0.5))

graf2_2 <- ggplot(mapping = aes(sample = reg2$residuals)) + 
  geom_qq() + 
  geom_qq_line() + 
  coord_flip() + 
  labs(x = "Residuales", y = "Escala Normal", caption = "Figura: Gráfica cuantil-cuantil") + 
  theme(plot.caption = element_text(hjust = 0.5))

ggarrange(graf2_1, graf2_2)
```


Número de bacterias explicado por temperatura y naturaleza ácida (efectos lineales):
```{r}
reg3 <- lm(Nbact ~ Temp + Acid, data = datos)

reg3 %>% 
  summary()

reg3 %>% 
  anova()
```
Número de bacterias explicado por temperatura y naturaleza ácida (efectos lineales e interacciones entre los regresores):

```{r}
graf3_1 <- ggplot() + 
  geom_point(mapping = aes(x = reg3$fitted.values, y = reg3$residuals)) +
  labs(x = "Respuesta Ajustada", y = "Residuales", caption = "Figura: Análisis de Residuales") + 
  theme(plot.caption = element_text(hjust = 0.5))

graf3_2 <- ggplot(mapping = aes(sample = reg3$residuals)) + 
  geom_qq() + 
  geom_qq_line() + 
  coord_flip() + 
  labs(x = "Residuales", y = "Escala Normal", caption = "Figura: Gráfica cuantil-cuantil") + 
  theme(plot.caption = element_text(hjust = 0.5))

ggarrange(graf3_1, graf3_2)
```


```{r}
reg4 <- lm(Nbact ~ Temp * Acid, data = datos)

reg4 %>% 
  summary()

reg4 %>% 
  anova()
```


```{r}
graf4_1 <- ggplot() + 
  geom_point(mapping = aes(x = reg4$fitted.values, y = reg4$residuals))+
  labs(x = "Respuesta Ajustada", y = "Residuales", caption = "Figura: Análisis de Residuales") + 
  theme(plot.caption = element_text(hjust = 0.5))

graf4_2 <- ggplot(mapping = aes(sample = reg4$residuals)) + 
  geom_qq() + 
  geom_qq_line() + 
  coord_flip() + 
  labs(x = "Residuales", y = "Escala Normal", caption = "Figura: Gráfica cuantil-cuantil") + 
  theme(plot.caption = element_text(hjust = 0.5))

ggarrange(graf4_1, graf4_2)
```


```{r}
reg5 <- lm(Nbact ~ Temp * Acid + Conc , data = datos)

reg5 %>% 
  summary()

reg5 %>% 
  anova()
```


```{r}
graf5_1 <- ggplot() + 
  geom_point(mapping = aes(x = reg5$fitted.values, y = reg5$residuals)) +
  labs(x = "Respuesta Ajustada", y = "Residuales", caption = "Figura: Análisis de Residuales") + 
  theme(plot.caption = element_text(hjust = 0.5))

graf5_2 <- ggplot(mapping = aes(sample = reg5$residuals)) + 
  geom_qq() + 
  geom_qq_line() + 
  coord_flip() + 
  labs(x = "Residuales", y = "Escala Normal", caption = "Figura: Gráfica cuantil-cuantil") + 
  theme(plot.caption = element_text(hjust = 0.5))

ggarrange(graf5_1, graf5_2)
```










